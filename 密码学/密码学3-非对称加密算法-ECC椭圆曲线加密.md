---
title: 密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)
---

[toc]

##### 非对称加密算法
非对称加密算法：对称加密算法在加密和解密时使用的是同一个秘钥；而非对称加密算法需要两个密钥来进行加密和解密，这两个秘钥是公开密钥（public key，简称公钥）和私有密钥（private key，简称私钥）。

非对称加密与对称加密相比，其安全性更好：对称加密的通信双方使用相同的秘钥，如果一方的秘钥遭泄露，那么整个通信就会被破解。而非对称加密使用一对秘钥，一个用来加密，一个用来解密，而且公钥是公开的，秘钥是自己保存的，不需要像对称加密那样在通信之前要先同步秘钥。

非对称加密的缺点是加密和解密花费时间长、速度慢，只适合对少量数据进行加密。

常用算法：非对称加密中使用的主要算法有：RSA、Elgamal、背包算法、Rabin、D-H、ECC（椭圆曲线加密算法）等

##### 非对称加密算法 Diffie-Hellman算法(D-H算法)，一种适基于密钥一致协议的加密算法。

Diffie-Hellman算法(D-H算法)，密钥一致协议,密钥协商算法。是由公开密钥密码体制的奠基人Diffie和Hellman所提出的一种思想。简单的说就是允许两名用户在公开媒体上交换信息以生成"一致"的、可以共享的密钥。换句话说，就是由甲方产出一对密钥（公钥、私钥），乙方依照甲方公钥产生乙方密钥对（公钥、私钥）。以此为基线，作为数据传输保密基础，同时双方使用同一种对称加密算法构建本地密钥（SecretKey）对数据加密。这样，在互通了本地密钥（SecretKey）算法后，甲乙双方公开自己的公钥，使用对方的公钥和刚才产生的私钥加密数据，同时可以使用对方的公钥和自己的私钥对数据解密。不单单是甲乙双方两方，可以扩展为多方共享数据通讯，这样就完成了网络交互数据的安全通讯！该算法源于中国的同余定理——中国馀数定理。

流程分析:
1. 甲方构建密钥对，将公钥公布给乙方，将私钥保留；双方约定数据加密算法；乙方通过甲方公钥构建密钥对儿，将公钥公布给甲方，将私钥保留。
2. 甲方使用私钥、乙方公钥、约定数据加密算法构建本地密钥，然后通过本地密钥加密数据，发送给乙方加密后的数据；乙方使用私钥、甲方公钥、约定数据加密算法构建本地密钥，然后通过本地密钥对数据解密。
3. 乙方使用私钥、甲方公钥、约定数据加密算法构建本地密钥，然后通过本地密钥加密数据，发送给甲方加密后的数据；甲方使用私钥、乙方公钥、约定数据加密算法构建本地密钥，然后通过本地密钥对数据解密。

##### 非对称加密算法 RSA

RSA：RSA公钥加密算法是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。1987年7月首次在美国公布，当时他们三人都在麻省理工学院工作实习。RSA就是他们三人姓氏开头字母拼在一起组成的。

RSA算法基于一个十分简单的数论事实：将两个大质数相乘十分容易，但是想要对其乘积进行因式分解却极其困难，因此可以将乘积公开作为加密密钥。

优缺点:
1. 产生密钥很麻烦，受到素数产生技术的限制，因而难以做到一次一密。
2. 安全性，RSA的安全性依赖于大数的因子分解，但并没有从理论上证明破译RSA的难度与大数分解难度等价，而且密码学界多数人士倾向于因子分解不是NP问题。
3. 速度太慢，由于RSA 的分组长度太大，为保证安全性，n 至少也要 600 bits以上，使运算代价很高，尤其是速度较慢，较对称密码算法慢几个数量级；且随着大数分解技术的发展，这个长度还在增加，不利于数据格式的标准化。SET(Secure Electronic Transaction）协议中要求CA采用2048比特长的密钥，其他实体使用1024比特的密钥。为了速度问题，人们广泛使用单，公钥密码结合使用的方法，优缺点互补：单钥密码加密速度快，人们用它来加密较长的文件，然后用RSA来给文件密钥加密，极好的解决了单钥密码的密钥分发问题。

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891786.png)

##### 非对称加密算法 ElGamal

ElGamal算法，是一种较为常见的加密算法，它是基于1985年提出的公钥密码体制和椭圆曲线加密体系。既能用于数据加密也能用于数字签名，其安全性依赖于计算有限域上离散对数这一难题。在加密过程中，生成的密文长度是明文的两倍，且每次加密后都会在密文中生成一个随机数K，在密码中主要应用离散对数问题的几个性质：求解离散对数（可能）是困难的，而其逆运算指数运算可以应用平方-乘的方法有效地计算。

##### 椭圆曲线加密 ECC
*[ECC]:英文全称"Ellipse Curve Cryptography"

###### 从射影平面讲起

古希腊数学家欧几里得的《几何原本》提出
五大公理：
1. 等量间彼此相等 ；
2. 等量加等量和相等 ；
3. 等量减等量差相等 ；
4. 完全重合的东西是相等的 ；
5. 整体大于部分

和五大公设：
1. 任意一点到另外任意一点可以画直线。
2. 一条有限线段可以继续延长。
3. 以任意点为心及任意的距离可以画圆。
4. 凡直角都彼此相等。
5. 同平面内一条直线和另外两条直线相交，若在某一侧的两个内角和小于二直角的和，则这二直线经无限延长后在这一侧相交。

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891790.png)

《几何原本》只有在第29个命题
一条直线与两条平行直线相交,则所成的内错角相等,同位角相等,且同旁内角之和等于两直角
中才用到第五公设，即《几何原本》中可不依靠第五公设而推出前28命题。因此，一些数学家提出，第五公设能不能不作为公设，而作为定理？能不能依靠前四个公设来证明第五公设？这就是几何发展史上最著名的，争论了长达两千多年的关于“平行线理论”的讨论
1820年代，俄国喀山大学罗巴切夫斯基用“至少可以找到两条相异的直线，且都通过P点，并不与直线R相交”代替第五公设，然后与欧氏几何的前四个公设结合成一个公理系统，他经过细致深入的推理过程中，得出了一个又一个在直觉上匪夷所思，但在逻辑上毫无矛盾的几何体系。
这种几何学被称为罗巴切夫斯基几何，简称罗氏几何。从罗氏几何学中，可以得出这样一个结论：逻辑上不矛盾的一些公理都有可能提供一种几何学。现存非欧几何的类型可以概括如下：

1. 坚持第五公设，引出欧几里得几何。
2. “可以引最少两条平行线”为公设，罗氏几何（双曲几何）。
3. “一条平行线也不能引”为公设，黎曼几何（椭圆几何）

![左：双曲几何，即罗氏几何；中：欧几里德几何；右：椭圆几何，即黎曼几何](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891785.png)

了解非欧式几何，就可以理解平行线的交点。
定义平行线相交于无穷远点P∞，使平面上所有直线都统一为有唯一的交点
性质：
1. 一条直线只有一个无穷远点；一对平行线有公共的无穷远点
2. 任何两条不平行的直线有不同的无穷远点（否则会造成有两个交点）
3. 平面上全体无穷远点构成一条无穷远直线

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891788.jpg)

射影平面：平面上全体无穷远点与全体平常点构成射影平面

射影平面点的定义:
``` 射影平面点的定义
对普通平面上点(x,y)，令x=X/Z，y=Y/Z，Z≠0，则投影为射影平面上的点(X:Y:Z)

(1) 求点（1,2）在新的坐标体系下的坐标
∵X/Z=1 ，Y/Z=2（Z≠0）

∴X=Z，Y=2Z ∴坐标为（Z:2Z:Z），Z≠0

即（1:2:1）（2:4:2）（1.2:2.4:1.2）等形如（Z:2Z:Z），Z≠0的坐标都是（1,2）在新的坐标体系下的坐标

(2) 求平行线L1：X+2Y+3Z=0 与L2：X+2Y+Z=0 相交的无穷远点
∵ L1∥L2 所以有Z=0， X+2Y=0

∴坐标为（-2Y:Y:0），Y≠0

即（-2:1:0）（-4:2:0）（-2.4:1.2:0）等形如（-2Y:Y:0），Y≠0
```

###### 群(集合) 

数学中的“群”是一个由我们定义了一种二元运算的集合，二元运算我们称之为“加法”，并用符号“+”来表示。为了让一个集合G成为群，必须定义加法运算并使之具有以下四个特性：

1. 封闭性：如果a和b是集合G中的元素，那么（a + b)也是集合G中的元素。
2. 结合律：(a + b) + c = a + (b + c);
3. 存在单位元0，使得a + 0 = 0 + a =a;
4. 每个元素都有逆元，即：对于任意a，存在b，使得a + b = 0.
5. 如果我们增加第5个条件：交换律： a + b = b + a, a(bc) = a\*c\*b, 那么，称这个群为 **阿贝尔(abelian)群**

配上通常概念的加法时，整数的集合Z就是一个群（同时还是个阿贝尔群）。而自然数的集合（N）就不是群，因为它不满足第4个特性。

“群”很有用，因为一旦我们证明它具备上述4个特性，那么我们就可以自由地获取到一些其他特性。比如：单位元是唯一的；此外，逆元也是唯一的，即：对于每一个a，存在唯一的一个b，使得a + b = 0 （我们可以将b写成-a）。后面我们会发现，群的这些特性以及其他存在的事实，或者直接或者间接，对于我们来说非常重要。

###### 椭圆曲线

* 一条椭圆曲线是在射影平面上满足威尔斯特拉斯方程（Weierstrass）所有点的集合

威尔斯特拉斯方程:
Y^2^Z+a~1~XYZ+a~3~YZ^2^=X^3^+a~2~X^2^Z+a~4~XZ^2^+a~6~Z^3^

*   椭圆曲线方程是一个齐次方程,**非奇异**的威尔斯特拉斯方程

y^2^+a~1~xy+a~3~y = x^3^+a~2~x^2^+a~4~x+a~6~

* 我们一般使用一个简化的等式所描述的点

y^2^=x^3^+ax+b

*   曲线上的每个点都必须是非奇异的（光滑的），偏导数FX(X,Y,Z)、FY(X,Y,Z)、FZ(X,Y,Z)不同为0, 所谓的”非奇异”或”光滑”的,在数学中是指曲线上任意一点都存在切线。
> 奇点类型: 左侧, 带一个尖角的曲线 (y2 = x3)。右侧, 带一个自交叉的曲线 (y2 = x3 – 3x + 2). 这两种都不是有效的椭圆曲线。

*   圆曲线的形状，并不是椭圆的。只是因为椭圆曲线的描述方程，类似于计算一个椭圆周长的方程故得名

根据a和b的值，椭圆曲线在平面上可以呈现不同形状。可以很容易看出并验证： 椭圆曲线是关于x-轴对称的。为了实现我们的目标，我们还需要把一个无穷远点（亦称之为理想点) 视为椭圆曲线的一部分。从现在开始，我们将用符号0（零）来代表无穷远点。

如果我们想显式地将无穷远点纳入考虑，我们可以按如下的方式细化椭圆曲线的定义：

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891714.png)

######  椭圆曲线示例

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891793.jpg)

###### 非椭圆曲线示例

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891795.jpg)
这两个方程都不是椭圆曲线,因为他们在（0:0:1）点处（即原点）没有切线，不满足椭圆曲线每个点都必须是非奇异的（光滑的）

###### 椭圆曲线的群公理

我们可以定义一个基于椭圆曲线的群。如下：

- 群中的元素是一条椭圆曲线上的点;
- 单位元为无穷远点O;
- 点P的逆元是其关于x-轴的对称点;
- 加法，满足以下规则: 对于3个处在同一直线上的非零点 P, Q 和 R, 它们的和 P + Q + R = 0.

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891796.jpg)

同一直线上的三个点之和等于0.
注意一下最后一个规则，我们需要的只是三个点同线，与点的次序无关。这意味着，如果P、Q和R同线，那么P + (Q + R) = Q + (P + R) = R + (P + Q) = • • • = 0. 这样，我们直观地证明了我们的“+”运算既满足结合律也满足交换律：我们创建了一个阿贝尔群。

###### 椭圆曲线阿贝尔群

我们已经看到了椭圆曲线的图象，但点与点之间好象没有什么联系。我们能不能建立一个类似于在实数轴上加法的运算法则呢？这就要定义椭圆曲线的加法群，这里需要用到近世代数中的阿贝尔群。在数学中，群是一种代数结构，由一个集合以及一个二元运算所组成。已知集合和运算(G,\*)如果是群则必须满足如下要求

*   封闭性：∀a,b∈G，a\*b ∈ G
*   结合性： ∀a,b,c∈G ，有 (ab)c = a* (b\*c)
*   单位元：ョe∈G， ∀a ∈G，有ea = ae = a
*   逆元： ∀a ∈G ，ョb∈G 使得 ab = ba = e

阿贝尔群除了上面的性质还满足交换律公理(ab)c = a* (b\*c)

同样在椭圆曲线也可以定义阿贝尔群。
任意取椭圆曲线上两点P、Q（若P、Q两点重合，则作P点的切线），作直线交于椭圆曲线的另一点R'，过R'做y轴的平行线交于R，定义P+Q=R。这样，加法的和也在椭圆曲线上，并同样具备加法的交换律、结合律

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891803.png)

###### 椭圆曲线的几何行为

得益于我们使用的是一个阿贝尔群，我们可以把 P + Q + R = 0 写成P + Q = –R。方程的这一形式，让我们可以推导出计算两点P和Q之和的几何方法：画一条过P和Q点的直线，这条直线与曲线相交得到第3个点R（这一事实意味着P、Q、R必然共线）。如果我们获取了该点的逆元-R，那么我们就得到了P + Q的结果。

![P+G=-R](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891794.png)

过P和Q画一条直线。该直线与曲线相交与第3点R。与之对称的点-R即为P+Q 的结果

这种几何方法可以成立，但还需一些改进。特别是，我们需要回答以下几个问题：
• 当P = 0或Q = 0时怎么办? 显然，我们无法画任何直线（0点不在xy-平面上）。不过，由于我们定义了0点为单位元，所以，对于任意P和任意Q，都有：P + 0 = P ， 0 + Q = Q

• 当P= –Q时怎么办? 这种情况下，通过两点的直线是一条垂线，与曲线不会有第三个交点。不过，由于P是Q的逆元，那么由逆元的定义可知P + Q = P + (-P) = 0 .

• 当P= Q时怎么办? 这种情况下，经过该点的直线有无数条。事情开始有点复杂了。不过，先想像一个点 Q’ ≠ P。如果我们令Q’ 向P逼近，越来越靠近P会怎么样？

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891800.gif)

随着两个点越来越接近，过这两点的直线最终变成了曲线的切线

随着Q’ 趋向P, 过P和Q’ 的直线最终成为曲线的切线。看到这一点，我们可以定义 P + P = –R, 其中R是过P点的切线与曲线的交点。
• 当P ≠ Q，但找不到第三个点R时怎么办? 这种情况和上面那个非常类似。实际上，这是因为过P和Q的直线与曲线相切。

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891805.gif)

如果直线与曲线只有两个交点，那么该直线为曲线的切线。可以很容易地看出，两点相加的结果是其中一点的对称点

假设P是切点，在上一情况中，我们已经得出P + P = –Q. 等式现在变为 P + Q = –P。 如果Q 是切点，正确的等式应为 P + Q = –Q.
现在，用几何方法可以完全覆盖所有情况了。用一支铅笔和一把尺，我们可以做任意椭圆曲线上所有点的加法运算。

###### 椭圆曲线的代数加法

如果我们想把点的加法运算计算机来完成，那么需要将几何方法转化为代数方法。将上面描述的规则转换为一组公式看似简单，实际上是非常繁琐的，因为需要求解三次方程。因此，这里我只通报结果。

首先，先抛开最恼人的极端情况。我们已经知道P + (-P) = 0, 还知道P + 0 = 0 + P = P。所以，在我们的公式中 ，我们将避免这两种情况，只考虑两个非零、非对称点 P = (xP, yP) 和Q = (xQ, yQ).

如果 P 和 Q 不相同， (xP ≠ xQ), 过这两点的直线斜率为:

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891798.png)

该直线与椭圆曲线交于第三点 R = (xR, yR):

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891799.png)

或是, 等价形式:

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891802.png)

因此，`(xP, yP) + (xQ, yQ) = (xR, –yR) ` (注意正负号，记住P + Q = –R).

如果我们想检查这一结果是否正确，我们将不得不检查R是否在曲线上，同时P、Q、Q是共线。检查点是否共线轻而易举，但检查R是否在曲线上就不容易了，因为需要求解三次方程，这可不是什么好玩的事儿。

不过，我们可以用一个例子来试一下：根据 可视化工具的计算， 当 P = (1, 2) 、Q = (3, 4) ，椭圆曲线 y2 = x3 – 7x + 10, 两点之和 P + Q = –R = (-3, 2). 让我们看一下与我们的公式是否一致:

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891801.png)

好的，正确!
注意上面的公式即使在其中一个点P或Q是切点的情况下也成立。让我们试一下P = (-1, 4) 、 Q = (1, 2).

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891804.png)

我们计算出 P + Q = (1, -2), 与使用 可视化工具计算出的结果相同。
P = Q 的情况需要做点不同的处理：方程中 xR 和 yR 相同, 由于 xP = xQ, 我们必须使用不同的公式来计算斜率：

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891806.png)

注意，我们可以料到，m的表达式实际是下面这个函数的一阶导数:

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891807.png)

为了证明结果的有效性，只要检查R是否在曲线上，以及P和R在曲线上只有两个交点就足够了。但同样，我们不去证明这一事实，而是试算一个例子: P = Q = (1, 2).

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891911.png)

公式计算出 P + P = –R = (-1, -4).正确!
尽管推导过程真的是极其繁琐，不过最后的公式还是很简洁。这要感谢魏尔斯特拉斯范式：要是没有这一范式，最后的公式会真的又长又复杂。

###### 椭圆曲线的标量乘法

在加法之外，我们还可以定义另一种运算：标量乘法，即：

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891830.png)

nP，其中n为自然数。我为标量乘法也写了个 可视化工具 ，如果你想试算时可以使用。
用这种形式表示时，计算nP似乎需要n次加法运算。如果n有k个二进制位，那么算法的时间复杂度将为O（2^k)，这真不是很好。不过存在一些更快的算法。

其中一种是“加倍（double)与相加（add)”算法。

计算的原理可以用一个例子来更好地解释。取n = 151。它的二进制表示形式为100101112 。这一二进制表示形式可以转换为一系列2的幂之和。

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891906.png)

(取n的 每个二进制位上的数字，并用它乘以一个2的幂.)
用这种方法，我们可以将n这样写:

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891907.png)

“加倍（double)与相加（add)”算法需要这样做:
• 取 P. • 加倍，得到2P. • 2P与P相加(为了得到 21P + 20P). • 加倍 2P，得到22 P. • 与前一结果相加 (得到 22P + 21P + 20P). • 加倍 22P，得到23P. • 对23P不做任何操作. • 加倍23P，得到24P. • 与前一结果相加 (得到 24P + 22P + 21P + 20P). • … 最后，我们可以计算151 • P ，只需7次“加倍”运算和4次“相加”运算。
如果“加倍”和“相加”操作复杂度均为O(1),那么 该算法的时间复杂度为O(log n) (或是O(k)，如果我们考虑的是二进制位的长度），这相当不错。比最初O(n)的算法肯定要好得多。

###### 椭圆曲线的对数

给定n和P, 我们现在至少有一个多项式时间算法来计算Q = nP。不过，逆运算需要计算多少轮呢？如果已知Q和P，我们想求解n会怎么样？这一问题被称为对数问题。我们称之为“对数”而不是“除法”是为了与其他加密系统（在术语上）保持统一（那些系统中，不称“乘法”，而称“幂”）。

我不知道任何关于对数问题的“易解”算法，不过，通过摆弄乘法 ，很容易发现一些模式。例如，对于曲线 y2 = x3 – 3x + 1和点 P = (0, 1). 我们可以立即验证出, 如果n为奇数，nP在曲线的左半面，如果n为偶数，nP在曲线的右半面。如果我们尝试更多次，我们或许可以找出更多的模式，最终可以让我们写出一个算法来高效计算那条曲线的对数问题。

`mP=P+P+...+P=Q`

这个等数中我们能看到已知m和P求点Q很容易,反正只知道Q和点P的情况下求m却是非常困难的,这个问题称为离散对数问题中的椭圆曲线上的点群。
我们学的椭圆曲线密码体制就是利用以上的这个困难问题来设计的。

###### 椭圆曲线的有限域

椭圆曲线是连续的，并不适合用于加密；所以，我们必须把椭圆曲线变成离散的点，我们要把椭圆曲线定义在有限域上。我们给出一个有限域Fp

*   Fp中有p（p为质数）个元素0,1,2,…, p-2,p-1
*   Fp的加法是a+b≡c(mod p)
*   Fp的乘法是a×b≡c(mod p)
*   Fp的除法是a÷b≡c(mod p)，即 a×b^(-1)≡c (mod p)，b-1也是一个0到p-1之间的整数，但满足b×b-1≡1 (mod p)
*   Fp的单位元是1，零元是 0
*   Fp域内运算满足交换律、结合律、分配律

椭圆曲线Ep(a,b)，p为质数，x,y∈\[0,p-1]

y^2^=x^3^+ax+b(modp)

选择两个满足下列约束条件的小于p的非负整数a、b

4a^3^+27b^2^≠0(modp)

Fp上的椭圆曲线同样有加法

*   1.无穷远点 O∞是零元，有O∞+ O∞= O∞，O∞+P=P
*   2.P(x,y)的负元是 (x,-y mod p)= (x,p-y) ，有P+(-P)= O∞
*   3.P(x1,y1),Q(x2,y2)的和R(x3,y3) 有如下关系：

x3≡k2-x1-x2(mod p)
y3≡k(x1-x3)-y1(mod p)
若P=Q 则 k=(3x2+a)/2y1mod p
若P≠Q，则k=(y2-y1)/(x2-x1) mod p

例题椭圆曲线已知E23(1,1)上两点P(3,10)，Q(9,7)，求(1)-P，(2)P+Q，(3) 2P

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891909.png)

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891908.png)

###### 有限域椭圆曲线点的阶

如果椭圆曲线上一点P，存在最小的正整数n使得数乘nP=O∞ ,则将n称为P的阶
若n不存在，则P是无限阶的

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/密码学3-非对称加密算法(主要介绍ECC椭圆曲线加密)/2020811/1597124891910.png)

计算可得27P=-P=(3,13)
所以28P=O ∞ P的阶为28
这些点做成了一个循环阿贝尔群，其中生成元为P，阶数为29。显然点的分布与顺序都是杂乱无章

###### 椭圆曲线加密

考虑K=kG ，其中K、G为椭圆曲线Ep(a,b)上的点，n为G的阶（nG=O∞ ），k为小于n的整数。则给定k和G，根据加法法则，计算K很容易但反过来，给定K和G，求k就非常困难。

因为实际使用中的ECC原则上把p取得相当大，n也相当大，要把n个解点逐一算出来列成上表是不可能的。这就是椭圆曲线加密算法的数学依据

点G称为基点（base point）
k（k<n）为私有密钥（privte key）
K为公开密钥（public key)

###### ECC保密通信算法

*   1.Alice选定一条椭圆曲线E，并取椭圆曲线上一点作为基点G 假设选定E29(4,20)，基点G(13,23) , 基点G的阶数n=37
*   2.Alice选择一个私有密钥k（k<n），并生成公开密钥K=kG 比如25, K= kG = 25G = (14,6）
*   3.Alice将E和点K、G传给Bob
*   4.Bob收到信息后，将待传输的明文编码到上的一点M（编码方法略），并产生一个随机整数r（r<n,n为G的阶数） 假设r=6 要加密的信息为3,因为M也要在E29(4,20) 所以M=(3,28)
*   5.Bob计算点C1=M+rK和C2=rG C1= M+6K= M+6\*25\*G=M+2G=(3,28)+(27,27)=(6,12) C2=6G=(5,7)
*   6.Bob将C1、C2传给Alice
*   7.Alice收到信息后，计算C1-kC2，结果就应该是点M C1-kC2 =(6,12)-25C2 =(6,12)-25\*6G =(6,12)-2G =(6,12)-(27,27) =(6,12)+(27,2) =(3,28)

数学原来上能解密是因为:C1-kC2=M+rK-krG=M+rkG-krG-M

###### ECC技术要求

通常将Fp上的一条椭圆曲线描述为T=(p,a,b,G,n,h)p、a、b确定一条椭圆曲线（p为质数，(mod p)运算）G为基点，n为点G的阶，h是椭圆曲线上所有点的个数m与n相除的商的整数部分参量选择要求：

*   p越大安全性越好，但会导致计算速度变慢
*   200-bit左右可满足一般安全要求
*   n应为质数
*   h≤4；p≠n×h ；pt≠1(mod n) (1≤t＜20)
*   4a3＋27b2≠0 (mod p)

###### ECC的应用

比特币系统选用的secp256k1中，参数为: 
- p = 0xFFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFE FFFFFC2F = 2^256 − 2^32 − 2^9 − 2^8 − 2^7 − 2^6 − 2^4 − 1
- a = 0
- b = 7
- G=(0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798, 0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8)
- n = 0xFFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFE BAAEDCE6 AF48A03B BFD25E8C D0364141
- h = 01