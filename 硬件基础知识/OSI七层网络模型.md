---
title: OSI七层网络模型
---

[toc]

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/OSI七层网络模型/2020811/1597124427049.png)

--------------

#### OSI 七层网络模型概述

![OSI七层协议](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/OSI七层网络模型/2020811/1597124427019.gif)

> OSI 七层模型通过七个层次化的结构模型使不同的系统不同的网络之间实现可靠的通讯，因此其最主要的功能就是帮助不同类型的主机实现数据传输 。
完成中继功能的节点通常称为中继系统。在OSI七层模型中，处于不同层的中继系统具有不同的名称。   
一个设备工作在哪一层，关键看它工作时利用哪一层的数据头部信息。

具体的来说有 : 
- 物理层：网卡，网线，集线器，中继器，调制解调器
- 数据链路层：网桥，交换机
- 网络层：路由器
- 网关工作在第四层传输层及其以上

1. **物理层** 进入的是==二进制流 #9C27B0==

在OSI参考模型中，物理层（Physical Layer）是参考模型的最低层，也是OSI模型的第一层。
物理层的主要功能是：利用传输介质为数据链路层提供物理连接，实现比特流的透明传输。
物理层的作用是实现相邻计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。使其上面的数据链路层不必考虑网络的具体传输介质是什么。“透明传送比特流”表示经实际电路传送后的比特流没有发生变化，对传送的比特流来说，这个电路好像是看不见的。

2. **数据链路层** 进入的是==数据帧 #9C27B0==

数据链路层（Data Link Layer）是OSI模型的第二层，负责建立和管理节点间的链路。该层的主要功能是：通过各种控制协议，将有差错的物理信道变为无差错的、能可靠传输数据帧的数据链路。
在计算机网络中由于各种干扰的存在，物理链路是不可靠的。因此，这一层的主要功能是在物理层提供的比特流的基础上，通过差错控制、流量控制方法，使有差错的物理线路变为无差错的数据链路，即提供可靠的通过物理介质传输数据的方法。
该层通常又被分为==介质访问控制（MAC）==和==逻辑链路控制（LLC）==两个子层。
MAC子层的主要任务是解决共享型网络中多用户对信道竞争的问题，完成网络介质的访问控制；
LLC子层的主要任务是建立和维护网络连接，执行差错校验、流量控制和链路控制。
数据链路层的具体工作是接收来自物理层的位流形式的数据，并封装成帧，传送到上一层；同样，也将来自上层的数据帧，拆装为位流形式的数据转发到物理层；并且，还负责处理接收端发回的确认帧的信息，以便提供可靠的数据传输。

3. **网络层** 进入的是==数据包 #9C27B0==

网络层（Network Layer）是OSI模型的第三层，它是OSI参考模型中最==复杂 #F44336==的一层，也是通信子网的最高一层。它在下两层的基础上向资源子网提供服务。其主要任务是：通过路由选择算法，为报文或分组通过通信子网选择最适当的路径。该层控制数据链路层与传输层之间的信息转发，建立、维持和终止网络的连接。具体地说，数据链路层的数据在这一层被转换为数据包，然后通过路径选择、分段组合、顺序、进/出路由等控制，将信息从一个网络设备传送到另一个网络设备。
一般地，数据链路层是解决同一网络内节点之间的通信，而网络层主要解决不同子网间的通信。例如在广域网之间通信时，必然会遇到路由（即两节点间可能有多条路径）选择问题。 

在实现网络层功能时，需要解决的主要问题如下：
- ==寻址==：数据链路层中使用的物理地址（如MAC地址）仅解决网络内部的寻址问题。在不同子网之间通信时，为了识别和找到网络中的设备，每一子网中的设备都会被分配一个唯一的地址。由于各子网使用的物理技术可能不同，因此这个地址应当是逻辑地址（如IP地址）。
- ==交换==：规定不同的信息交换方式。常见的交换技术有：线路交换技术和存储转发技术，后者又包括报文交换技术和分组交换技术。
- ==路由算法==：当源节点和目的节点之间存在多条路径时，本层可以根据路由算法，通过网络为数据分组选择最佳路径，并将信息从最合适的路径由发送端传送到接收端。
- ==连接服务==：与数据链路层流量控制不同的是，前者控制的是==网络相邻节点间的流量 #F44336==，后者控制的是==从源节点到目的节点间的流量 #F44336==。其目的在于防止阻塞，并进行差错检测。

4. **传输层** （TCP/UDP）进入的是==数据段 #9C27B0==

OSI下3层的主要任务是数据通信，上3层的任务是数据处理。而传输层（Transport Layer）是OSI模型的第4层。因此该层是通信子网和资源子网的接口和桥梁，起到承上启下的作用。
该层的主要任务是：向用户提供可靠的端到端的差错和流量控制，保证报文的正确传输。传输层的作用是向高层屏蔽下层数据通信的细节，即向用户透明地传送报文。该层常见的协议：TCP/IP中的TCP协议、Novell网络中的SPX协议和微软的NetBIOS/NetBEUI协议。

传输层提供会话层和网络层之间的传输服务，这种服务从会话层获得数据，并在必要时，对数据进行分割。然后，传输层将数据传递到网络层，并确保数据能正确无误地传送到网络层。因此，传输层负责提供两节点之间数据的可靠传送，当两节点的联系确定之后，传输层则负责监督工作。综上，传输层的主要功能如下：
- ==传输连接管理==：提供建立、维护和拆除传输连接的功能。传输层在网络层的基础上为高层提供“面向连接”和“面向无接连”的两种服务。
- ==处理传输差错==：提供可靠的“面向连接”和不太可靠的“面向无连接”的数据传输服务、差错控制和流量控制。在提供“面向连接”服务时，通过这一层传输的数据将由目标设备确认，如果在指定的时间内未收到确认信息，数据将被重发。
- ==监控服务质量。==

5. **会话层**

会话层（Session Layer）是OSI模型的第5层，是用户应用程序和网络之间的接口，主要任务是：向两个实体的表示层提供建立和使用连接的方法。将不同实体之间的表示层的连接称为会话。因此会话层的任务就是组织和协调两个会话进程之间的通信，并对数据交换进行管理。
用户可以按照半双工、单工和全双工的方式建立会话。当建立会话时，用户必须提供他们想要连接的远程地址。而这些地址与MAC（介质访问控制子层）地址或网络层的逻辑地址不同，它们是为用户专门设计的，更便于用户记忆。域名（DN）就是一种网络上使用的远程地址例如：www.3721.com 就是一个域名。会话层的具体功能如下：

- ==会话管理==：允许用户在两个实体设备之间建立、维持和终止会话，并支持它们之间的数据交换。例如提供单方向会话或双向同时会话，并管理会话中的发送顺序，以及会话所占用时间的长短。
- ==会话流量控制==：提供会话流量控制和交叉会话功能。
- ==寻址==：使用远程地址建立会话连接。l
- ==出错控制==：从逻辑上讲会话层主要负责数据交换的建立、保持和终止，但实际的工作却是接收来自传输层的数据，并负责纠正错误。会话控制和远程过程调用均属于这一层的功能。但应注意，此层检查的错误不是通信介质的错误，而是磁盘空间、打印机缺纸等类型的高级错误。

6. **表示层**

表示层（Presentation Layer）是OSI模型的第六层，它对来自应用层的命令和数据进行解释，对各种语法赋予相应的含义，并按照一定的格式传送给会话层。其主要功能是“处理用户信息的表示问题，如编码、数据格式转换和加密解密”等。表示层的具体功能如下：

- ==数据格式处理==：协商和建立数据交换的格式，解决各应用程序之间在数据格式表示上的差异。
- ==数据的编码==：处理字符集和数字的转换。例如由于用户程序中的数据类型（整型或实型、有符号或无符号等）、用户标识等都可以有不同的表示方式，因此，在设备之间需要具有在不同字符集或格式之间转换的功能。
- ==压缩和解压缩==：为了减少数据的传输量，这一层还负责数据的压缩与恢复。
- ==数据的加密和解密==：可以提高网络的安全性。

7. **应用层**

应用层（Application Layer）是OSI参考模型的最高层，它是计算机用户，以及各种应用程序和网络之间的接口，其功能是直接向用户提供服务，完成用户希望在网络上完成的各种工作。它在其他6层工作的基础上，负责完成网络中应用程序与网络操作系统之间的联系，建立与结束使用者之间的联系，并完成网络用户提出的各种网络服务及应用所需的监督、管理和服务等各种协议。此外，该层还负责协调各个应用程序间的工作。
应用层为用户提供的服务和协议有：文件服务、目录服务、文件传输服务（FTP）、远程登录服务（Telnet）、电子邮件服务（E-mail）、打印服务、安全服务、网络管理服务、数据库服务等。上述的各种网络服务由该层的不同应用协议和程序完成，不同的网络操作系统之间在功能、界面、实现技术、对硬件的支持、安全可靠性以及具有的各种应用程序接口等各个方面的差异是很大的。应用层的主要功能如下：

- ==用户接口==：应用层是用户与网络，以及应用程序与网络间的直接接口，使得用户能够与网络进行交互式联系。
- ==实现各种服务==：该层具有的各种应用程序可以完成和实现用户请求的各种服务。

----------------------

下面我们就详细来看看每一层各自的内容.

#### 物理层

**网络介质:** 
以太网，路由器上的串行接口，网卡(NIC network interface card)，网线，集线器，中继器，调制解调器

**传输介质:**
主要的传输都是以太网(有线/无线),主要讲讲有线传输.一般会有如此的标识:
- 10 BASE-T
- 100 BASE-TX
- 1000 BASE-CX
- 1000 BASE-SX

说明
1. 第一部分是速率10M，100M，1000M
2. 第二个base代表基带传输 以太网都是基带传输(还有宽带传输)
3. 第三部分是传输介质
	- T,TX  代表铜质双绞线
	- FX,SX,LX -> 光纤 F=>fiber(LX->单模 single-mode fiber-> long 长距离传输,SX->多模 multimode fiber -> short 短距离传输)

==双绞线==
整个线缆有8根线缆 分为4组 绞在一起是为了抗干扰
双绞线大致速度可能在10M-1000M之间
双绞线分为UTP和STP =>UTP:非屏蔽双绞线,STP:屏蔽双绞线
屏蔽双绞线在每一组双绞线外还有金属屏蔽层，抗干扰更强，但是重，成本高，不利于布线，所以常用UTP 非屏蔽双绞线
非屏蔽双绞线的最长传输距离大概是100M，超出则必须用中继或集线器放大信号，或者使用光纤，实际使用不能超过90M
双绞线接口 RJ-45 Connector 俗称水晶头，插槽 RJ-45 Jack(信息点)
水晶头8个铜线的接口接线是有顺序的 双绞线线序
568A,568B(国内常用)
568B:橙白,橙,绿白,蓝,蓝白,绿,棕白,棕
568A:将1-3,2-6交换 绿白,绿,橙白,蓝,蓝白,橙,棕白,棕
12为网络传输的发,36为网络的收，同时的收和发
45的蓝色线是可以用来接电话的
直通线(平行线)是两个接口都是568B 在不同的设备间用直通线
交叉线是两个接口分别是568A和568B 在相同的设备间用交叉线
备注:交换机和集线器之间要用交叉线,电脑连路由器也要用交叉线
总之，同一层设备相连用交叉线；不同一层设备相连用直连线

==光纤==
成对出现 连接时两端对调
LX=>single mode 单模 传输距离长 可以达到上千米
SX=>multimode 多模 传输距离适中

-----------------------

#### 数据链路层

**网络介质：**
网桥(早期 bridge)，交换机(Main switch)，NIC(网卡 network interface card)

LAN(local area network)
主要的协议是以太网协议 ==802.2,802.3协议族==
也可能是其他的拨号上网,3G PPP 协议族,FR 帧中继协议

数据链路层主要还分为两个子层 LLC 和 MAC
logical link control 3层和2层之间的通信
media access control 识别和对于底层物理层传输的控制

二层编址 - Mac Address Components
对于以太网这种共享型网络在一个传输介质上可以链接很多传输主机都通过该介质传输输出
mac地址保存在网卡的rom中烧录的，一般是不可改变，但可以被伪造

mac地址有48位
1:Broadcast 广播
1:Local         本地
22:OUI         组织唯一标示符 生产厂商的唯一标示符
24:Vendor Assigned 厂商分配的 用来标示该厂商生产的不同设备
理论上mac地址是要全球唯一的，但48很短，一般现在是作为本地唯一。即在中国地区唯一，或者欧美地区唯一

以太网帧传输结构
8:preamble即报头
6:目标mac地址
6:源mac地址
2:type类型
46-1500:data
4:fcs校验码

单播 unicast/广播 broadcast/组播(多播) multicast
广播地址=>0xFF:FF:FF:FF:FF:FF
组播地址=>高24bit为0x01005e，mac 地址的低23bit为组播ip地址的低23bit

------------------

#### 网络层

**网络介质：**
路由器

IP逻辑编址和路由功能（最短路由路径）
在2层中使用mac地址是平面的分址方式，所有的地址都处在一个广播域中
为了防止广播风暴等共计方式，使用网段隔离方式来防止，这就是在第三层实现的
为了更方便定位设备，对设备区分应用的策略，IP分址出现了

**IP协议**
Internet Protocol Characteristics ipv4/ipv6
ip地址包含网络部分和主机部分
ipv4 有32位
ipv6 有128位
结构化的编址,面向非链接，尽量进行发送，没有数据恢复机制

主机之间直接通信必须处在同一网段 使用的是二层的mac地址
如果是不同网段的主机就必须通过路由功能

路由:通过路由表的记录，在不同的网关之间相互进行数据转发
路由器一般拥有多个接口，每个接口连接到一个网段，并且拥有该网段的一个IP地址，这个地址就是这个网段的网关IP地址
路由器在不同的网段可以做到隔离广播的功能，路由器是不转发广播包的
路由器自身会通过不同的方式来维护路由表，根据路由表来完成不同网段数据转发
路由器还具有在不同网络路径之间选择最优路径的功能

MTU：单次传输数据最大网络传输单元 1500
IP包头 20
TCP包头 20

IP地址包含 network网络部分+host主机部分
IP地址分类 标志 2^n-2 台主机
A类地址：前8为netowrk ，后面24位 host 大型网络 =16777214
B类地址：前16, 后16位host 中型网络 =65534
C类地址：前24 ,后8位host, 小型网络  =254
D类地址：组播地址 1110
E类地址：保留 11110

主机部分为全0 表示是一个网络 。 192.168.1.0
主机部分为全1 表示是一个广播地址。192.168.1.255

私有地址 所有人都可以使用 但不能出现在公共网络中的地址
10.0.0.0 to 10.255.255.255
172.16.0.0 to 172.31.255.255
192.168.0.0 to 192.168.255.255

**DNS服务器**
域名->IP地址的转换

在3层中通信用的是IP地址，但是在2层中是用的mac地址
但是3层肯定是要传输到2层的。怎么通过IP地址获取mac地址呢,就是这个 ==ARP协议==

ARP协议的缺陷
ARP协议是建立在信任局域网内所有结点的基础上的，它很高效，但却不安全。它是无状态的协议，不会检查自己是否发过请求包，也不管（其实也不知道）是否是合法的应答，只要收到目标MAC是自己的ARP reply包或arp广播包（包括ARP request和ARP reply），都会接受并缓存。这就为ARP欺骗提供了可能，恶意节点可以发布虚假的ARP报文从而影响网内结点的通信，甚至可以做“中间人”。

--------------------------

#### 传输层

**主要介质:**
网关工作在第四层传输层及其以上

**点(端)对点(端)的传输的主要协议:**
- TCP 面向连接的传输协议
- UDP 非面向连接的传输协议

**可靠性 vs 性能**
TCP :
1. 面向链接传输前建立连接协调速率和是否传输 顺序发送序列号表示
2. 实时性要求不高 对精确性要求高 性能要求一般
3. 会话多路复用
4. 对数据进行分段传输 数据段
5. 流控机制
6. 可靠 会在传输前做一个链接判断，在传输出错时会有重传机制

UDP
1. 类比于IP协议 使用端口多路复用,非面向链接，非顺序，尽可能进行传输 效率高
2. 实时性要求高，对丢包不敏感 传输数据大，比如语音和图像数据

**数据包格式**

==TCP数据报文==

![TCP数据包格式](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/OSI七层网络模型/2020811/1597124427052.jpg)

- Source Port是源端口，16位。
- Destination Port是目的端口，16位。
- Sequence Number是发送数据包中的第一个字节的序列号，32位。
- Acknowledgment Number是确认序列号，32位。
- Data Offset是数据偏移，4位，该字段的值是TCP首部（包括选项）长度除以4。[1] 
- 标志位： 6位，
	* URG表示Urgent Pointer字段有意义：
	* ACK表示Acknowledgment Number字段有意义
	* PSH表示Push功能，RST表示复位TCP连接
	* SYN表示SYN报文（在建立TCP连接的时候使用）
	* FIN表示没有数据需要发送了（在关闭TCP连接的时候使用）
- Window表示接收缓冲区的空闲空间，16位，用来告诉TCP连接对端自己能够接收的最大数据长度。
- Checksum是校验和，16位。
- Urgent Pointers是紧急指针，16位，只有URG标志位被设置时该字段才有意义，表示紧急数据相对序列号（Sequence Number字段的值）的偏移。

==UDP数据包==

![IP数据包](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/OSI七层网络模型/2020811/1597124427048.jpg)

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/OSI七层网络模型/2020811/1597124427047.jpg)

UDP报头由4个域组成，其中每个域各占用2个字节，具体如下： 
源端口号
目标端口号
数据报长度
校验值

UDP协议使用端口号为不同的应用保留其各自的数据传输通道。UDP和TCP协议正是采用这一机制实现对同一时刻内多项应用同时发送和接收数据的支持。数据发送一方（可以是客户端或服务器端）将UDP数据包通过源端口发送出去，而数据接收一方则通过目标端口接收数据。有的网络应用只能使用预先为其预留或注册的静态端口；而另外一些网络应用则可以使用未被注册的动态端口。因为UDP报头使用两个字节存放端口号，所以端口号的有效范围是从0到65535。一般来说，大于49151的端口号都代表动态端口。

数据报的长度是指包括报头和数据部分在内的总字节数。因为报头的长度是固定的，所以该域主要被用来计算可变长度的数据部分（又称为数据负载）。数据报的最大长度根据操作环境的不同而各异。从理论上说，包含报头在内的数据报的最大长度为65535字节。不过，一些实际应用往往会限制数据报的大小，有时会降低到8192字节。

UDP协议使用报头中的校验值来保证数据的安全。校验值首先在数据发送方通过特殊的算法计算得出，在传递到接收方之后，还需要再重新计算。如果某个数据报在传输过程中被第三方篡改或者由于线路噪音等原因受到损坏，发送和接收方的校验计算值将不会相符，由此UDP协议可以检测是否出错。这与TCP协议是不同的，后者要求必须具有校验值。

> 会话 表示 和应用层更多的是与软件有关的部分了,略

#### 以太网和TCP/IP中的若干名词解释

##### 以太网(Ethernet)

以太网是一套标准，制定了相当于 [OSI 模型](https://en.wikipedia.org/wiki/OSI_model) 中第一层（物理层）和第二层（数据链路程）的技术规范。

在物理层上，以太网采用 RJ45 接口和双铰线，光纤，电磁波等方式来传递信号。

在数据链路层上，每个通信节点（主机的网络接口）都有 48 位(bit)全局唯一的 _MAC 地址_。通信数据流被切分并打包成帧(Frame)来发送，每帧都包含来源节点和目的节点的 MAC 地址。

##### 网段(Network Segment)

中继器，集线器是和网线一样工作在物理层的硬件设备。被它们连接在一起的部分被称为_网段_（日常所说的网段，意义可能与本文中不同，一般指子网）。网段是_冲突域_，每次通信时，数据帧会被发送到同网段所有的节点，但只有目的节点(由帧中的目的节点MAC定义)会处理该帧，其它节点则将其忽略。

中继器(Repeater)用于延长网络传输的有效距离。

集线器(Hub)可被视为多口的中继器，用于接通多个节点。由于处于同一冲突域，节点间的通信会互相影响，产生性能问题，现在集线器基本上已经被交换机取代了。

##### 网络(Network)

网桥，交换机是工作在数据链路层的硬件设备，被它们连接在一起的部分被称为_网络_。网络是_广播域_，其中各个节点都能通过数据链路层直接相互通信。

网桥(Bridge)用于连接两个网段，可以过滤不同网段间的流量。

交换机(Switch)可被视为多口的网桥。它可以动态地为通信双方构造单独的网段，保障通信不受其它节点的干扰。网桥和交换机的端口不需要有 MAC 地址。

##### 网际协议(IP, Internet Protocol)

网际协议(IP)也称互联网协议， 位于 OSI 第三层，网络层。它负责在不同的网络中的节点之间传输数据。

在 IP 中，节点拥有_IP 地址_，数据被打包成数据报(Datagram)，通过网络间的_路由_过程，从一个地址传输另外一个地址。数据报头部包含了来源及目的地的 IP 地址。

IPv6 是 IP 协议的新版本，最终目标是取代 IPv4。它带来了更大的地址空间，更方便的配置管理，更高效的网际路由，更安全的通信技术。

##### IP 地址

IP 地址是一个数字，用于对 IP 网络中的节点进行标识和寻址。

IPv4 地址是 32 位(bit)无符号整数。为方便记忆和沟通，通常把这 32 位划分为 4 组 8 位，分别写成一个十进制整数（其中每个整数的范围在 0 ~ 255 之间），用小数点连接起来。如地址 3232248321 可写为 `192.168.50.1`。

IPv6 地址是 128 位无符号整数。通常划分为 8 组 16 位，分别写成一个十六进制整数（其中每个整数的范围在 0000 ~ ffff 之间），用冒号连接起来。如地址 42540766464534556858822563802705297408 可写为 `2001:0DB8:AC10:FE01:0000:0000:0000:0000`。这种写法可以按照标准进行简化：字母写成小写，省略每组中的前导 0 ，多个连续的值为 0 的组可以用两个冒号代替（但是一个 IP 地址中只有最长的连续 0 组能代替一次）。按这样的规则，上面的地址可以简化为：`2001:db8:ac10:fe01::`。

单个 IP 地址可划分为两部分，前一部分是网络标识，后一部分是主机标识。

##### 网络ID

为正常通信，同一个网络内的节点，其 IP 地址中的网络标识应该相同，这部分被称为_网络ID_。因为出现在主机标识的前方，所以也称为_网络前缀_。同时，它在路由的过程中使用到了，因此又称为_路由前缀_。同一网络内，主机标识不应重复。

在 IPv4 中网络 ID 的长度可以用_网络掩码_描述，如掩码 `255.255.0.0` 代表一个前 16 位为 1，后面为 0 的 32 位数字，因而它描述的网络 ID 长度为 16 位。

网络 ID 长度也可以使用 [CIDR](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing) 形式描述。这种格式包含了 IP 地址和网络 ID 长度，如 `192.168.1.0/24` 代表 ID 长度为 24 位。CIDR 格式可用于表示单个 IP 地址配置, 也可以代表整个 IP 地址块。

在 IPv6 中，表示网络信息只能使用 CIDR 格式，不能使用掩码格式。

##### 子网(Subnet)

大部分情况下，_子网_ 等同于网络。子网有时也被人称为“网段”。

在大型网络中，节点较多，出于性能，安全或管理方面的原因，可以将单个网络划分为多个较小的子网络。这种场景下才有必要区分子网与网络。子网的 ID 以网络的 ID 为起始，后面包含额外的若干位。如网络的 ID 为 `200.100.0.0`，子网的 ID 可以为 `200.100.1.0`，`200.100.2.0` 等。_VLAN_ 就是一种子网划分技术。

子网本身也是单独的网络。划分为子网后，不同子网间的通信需要使用到路由器，或三层交换机等网关设备。

##### 地址解析协议(ARP, Address Resolution Protocol)

ARP 用于在网络层地址（IPv4 地址）和链路层地址（以太网中就是 MAC 地址）间进行翻译。它工作在二层和三层之间，如果一定要安排到七层之中的话，ARP 只能算二层协议。

以太网中两个节点通信需要知道对方的 MAC 地址。因此，为使用 IP 协议，每个节点会缓存一个 ARP 表，记录已知的 MAC 地址和 IP 地址的对应关系。需要与同网某个 IP 通信时，如果缓存表中无法找到对应的 MAC 地址，节点就会发出一条 ARP 请求，广播到网络中所有的节点。该 IP 对应的节点会进行回复，原节点根据回复提供的 MAC 地址继续通信，同时将信息记入缓存表。除了这样的请求应答方式以外，每个节点也可以主动发送广播，声明自己的 IP 和 MAC 地址，以更新其它节点的缓存表。

ARP 不对各个节点进行身份验证，因此可能产生 _ARP 欺骗_ 问题，即某节点假装自己是其它节点，进行信息窃取或欺骗；或实施拒绝服务攻击。对应的解决方案可以是静态配置 MAC/IP 对应关系，或者缩小网络的范围（如划分成子网）等。

IPv6 中，邻居发现协议（NDP, [Neighbor Discovery Protocol](https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol))取代了 ARP。NDP 中区分了路由器和普通节点。它不仅能在 IP 地址和链路层地址间进行翻译，还可以为节点配置网络参数如IP地址，网络ID，DNS 等(SLAAC, [Stateless address autoconfiguration](https://en.wikipedia.org/wiki/IPv6_address#Stateless_address_autoconfiguration))。

##### 路由(Routing)

同一网络内部的通信，在 ARP 的辅助下，使用工作于[OSI 模型](https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B)二层及以下的网络硬件进行传输，如交换机，集线器，中继器，网桥等。

跨网络的通信，根据 IP 协议的规定，需要逻辑上的_网关_参与。网关同时连接到本地网络和外部网络，拥有两个分别属于不同网络的 IP 地址。每台主机的网络协议软件栈中都包含一个_路由表_，用于配置路由规则，即哪些接收方使用哪个网络接口，发送到哪个网关。当所有的路由规则都不匹配时，数据会被发送到_默认网关_。网关全权负责对网络外部的通信。现实场景下，网关设备有可能进行网络地址翻译([NAT](https://en.wikipedia.org/wiki/Network_address_translation))。如果不同的网络间数据传输方式有区别，网关设备还负责将数据翻译为对应的格式。_调制解调器_(俗称猫)，如ADSL猫，光猫等，都属于网关设备。

_路由器_ 是一种多口网关。网关与路由器的关系，类似于网桥与交换机的关系，或中继器与集线器的关系。集线器直接转发所有的信号，交换机根据二层地址（MAC 地址）进行转发，路由器则根据三层地址（IP 地址）来转发。和普通的主机一样，它也配置有路由表。常见的单 WAN 口家用路由器，实际上是双口路由器+交换机+其它功能的集成设备。

##### TCP 与 UDP

这是两种基于 IP 协议的传输层协议。

用户数据报协议(UDP, User Datagram Protocol)是 IP 层的简单封装。它提供了可选的数据错误检测机制，还增加了端口概念，以区分同一主机上的不同应用或会话。与底层的 IP 一样，它不保证通信数据是否重复，乱序或丢失。

传输控制协议(TCP, Transmission Control Protocol) 提供了可靠的，有序的数据流传输服务。它也同样提供端口概念。TCP 将数据流切分包装成段(Segment，也称包, Packet)，交给 IP 传输。TCP 通过确认，重传，重新组合等方式，解决数据段丢失，重复，乱序等问题，将接收到的数据重新整合为数据流，提供给应用层协议。TCP 面向连接，因此通信前，双方需要先建立连接。

这两种协议中，双方各自通过一个端口与对方通信。端口使用 16 位正整数（范围 0 ~ 65535）来标识，称为端口号。_服务器_ 主动侦听固定的端口，_客户端_ 通常不关注自己的端口号，因此经常使用临时端口。

##### 动态主机设置协议(DHCP, Dynamic Host Configuration Protocol)

DHCP 用于动态配置IPv4网络节点。它是一种应用层协议，基于传输层协议 UDP。

节点加入网络时，可以使用手工配置的网络和节点信息（IP 地址，网络ID，DNS 等）。也可以根据 DHCP 协议，临时用空IP（0.0.0.0）以 UDP 协议向网络广播特定的请求消息。DHCP 服务器会直接将回复关联到节点的 MAC 地址（这个过程实际上也是跨越协议层次工作的）。节点获得回复后即可根据配置信息进行正常的通信了。

IPv6 中，相关功能主要由 NDP 完成，但是也可以同时使用 DHCPv6 来提供更多其它信息。

##### 网络地址翻译(NAT, Network Address Translation)

NAT 是网关在传输数据的过程中改写其中发送方/接收方 IP 地址（很可能还有端口号）的技术，它大规模应用于缓解 IPv4 地址空间不足的问题。

处于内网的主机，需要与外界通信时，发出的数据包通过拥有外网地址的网关。网关将包中的发送方地址替换为自己的外网地址，同时还可能将端口号替换为新的端口号，然后再转发出去，接收方只能看到替换后的地址和端口号。网关会记录发送方的内网地址，更改前后的端口号，以及接收方的地址和端口号。收到对方回复时，网关根据记录的信息，将数据包中的接收方IP（目前是网关的外网IP）和端口号替换为内网IP和原发起端口，然后转发回内网主机。

通常，处于内网的主机只能作为客户端发起通信，无法作为服务器被动等待外界通信。除非网关配置了端口转发，将外网 IP 某些端口的通信转发给它。网关也有可能配置了 DMZ 主机选项，所有来自外网且未明确指定转发规则的端口通信，都会转发给 DMZ 主机。如果用户从 ISP （电信运营商）那里只能得到内网地址，这意味着 NAT 网关由 ISP 管理 ，此时用户无法配置端口转发等选项，设备也无法作为对外服务器使用。

##### Windows 中的公用/专用网络

Windows 中可以把单个网络设置为“公用”或“专用”等不同的类型，并针对各个类型执行独自的防火墙规则。

这里的公用网络并不代表外网。和专用网络一样，它也是由二层设备连接起来的网络，只是任何人都可能连接进来，不像家庭/工作网络那样用户相对固定。由于公用网络上更有可能存在恶意节点，所以安全规则需要比在专用网上更严密。

Windows 用以区分不同网络的依据是 DNS 域名后缀和默认网关的 MAC 地址。