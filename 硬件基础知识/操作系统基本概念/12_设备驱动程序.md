---
title: 12_设备驱动程序
tags: 
---

设备驱动程序充当了硬件和软件之间的枢纽，驱动程序屏蔽同底层硬件的交互细节，对软件提供统一的调用接口，这些接口由操作系统事先定义并制定实现的标准规范，接口和实现规范合称为驱动架构。

Linux内核提供了基础的设备驱动程序，如果需要硬件设备性能最大化则需要在此基础上做定制开发。

Linux将所有设备都当做文件处理，分为两种类型

- 字符设备

	字符设备提供连续的数据流，应用程序可以顺序读取，通常不支持随机存取，如键盘等

- 块设备

	块设备支持随机存取，读写数据的单位通常是一个块(512byte)，如硬盘等

两者最大的差异是其驱动程序对外的接口不一样。设备文件由VFS(virtual file system，虚拟文件系统)管理，用主设备号标识设备驱动程序，从设备号标识同一设备驱动程序下的不同硬件，如同一个磁盘驱动程序下的多块磁盘。当应用程序通过C库函数调用系统调用操作设备时，系统调用会通过VFS找到对应设备文件，然后调用其驱动程序完成设备操作。

设备驱动程序由C/C++语言开发，属于内核代码，只能在内核态下执行。设备驱动程序直接操作设备控制器的寄存器，设备控制器就是类似于CPU的集成电路芯片，大概流程如下：驱动程序将操作参数和指令写入寄存器，由设备控制器将寄存器中值转换成高低电平信号，推动硬件设备完成相应操作，然后从寄存器读取操作结果，将结果由内核空间拷贝到用户空间。调用关系如下图：

![](https://raw.githubusercontent.com/OliverRen/olili_blog_img/master/11_设备驱动程序/20201122/1606050615653.png)