---
title: Filecoin简介
tags: 小书匠语法
renderNumberedHeading: true
grammar_abbr: true
grammar_table: true
grammar_defList: true
grammar_emoji: true
grammar_footnote: true
grammar_ins: true
grammar_mark: true
grammar_sub: true
grammar_sup: true
grammar_checkbox: true
grammar_mathjax: true
grammar_flow: true
grammar_sequence: true
grammar_plot: true
grammar_code: true
grammar_highlight: true
grammar_html: true
grammar_linkify: true
grammar_typographer: true
grammar_video: true
grammar_audio: true
grammar_attachment: true
grammar_mermaid: true
grammar_classy: true
grammar_cjkEmphasis: true
grammar_cjkRuby: true
grammar_center: true
grammar_align: true
grammar_tableExtra: true
---

[toc]

#### 初识 Filecoin

Filecoin是一种分散式存储网络，可将云存储变成算法市场。矿工通过提供数据存储或检索来获取本地协议令牌（也称为“FIL”），另一方面，客户向矿工付费以存储或分发数据并检索数据。

我们所说的Filecoin有四大方面的含义： 

1. BlockChain :
跟其它区块链项目一样，这是filecoin的基础，一切都是围绕block和chain进行的。

2. 交易市场 :
filecoin拥有两个交易市场，检索市场和存储市场，矿工和用户在这两市场里面达成交易，实现价值交换。

3. 共识机制 :
有交易和区块链必然要有谁记账的问题，filecoin也一样，必然要解决的一个问题是，共识机制。
将矿工当前在网中使用的存储量和生成的时空证明转化为投票的权重，然后节点利用这个权重进行选举产生一个或者多个领导节点，领导节点创建新的block并把它们传播到网络。filecoin的block数据结构采用了DAG结构。

4. 智能合约 :
filecoin采用了两个基本的api供用户使用，数据存储put，数据获取get，在这两种操作的基础上filecoin支持文件合约(File Contracts)，让用户可以有更精细化的控制。filecoin集成了合约系统和桥系统，把filecoin的存储系统提供给其他区块链系统使用，同时可以让filecoin使用其它区块链的功能。

Filecoin涉及的一些证明 :

- 数据持有证明(PDP): 用户发送数据给矿工存储, 矿工证明数据已经被自己存储
- 可检索证明(PoRet): 和PDP过程类似, 证明矿工存储的数据是可以用来查询
- 存储证明(PoS proofs-of-storage): 利用存储空间进行证明, 工作量证明的一种, 性的论文把名称变成了 PoRep
- 复制证明(PoRep): 保证每份数据都说独立存储, 可以防止女巫攻击, 外源攻击和生成攻击,PoRep 是 PoS 的进化版, 用来证明数据已经被矿工存储
- 工作量证明(PoW): 证明者向检验者证明自己花费了一定资源, PoW 被用在加密货币, 拜占庭共识和其他各种区块链操作系统. BTC使用的就是这种证明
- 空间证明(PoSpace): Filecoin 提出的概念, 存储量的证明, PosSpace 是 PoW 的一种, 不同的是 PoW 使用的计算资源, 而 PsSpace 使用的存储资源
- 时空证明(PoSt): 矿工证明自己花费了 spacetime 资源,即一定时间内存储空间的使用, PoSt 是基于 PoReps 实现

Filecon在拜占庭容错BTF的基础上提出了改进版的拜占庭容错，影响力容错(Power Fault Tolerance)和预期共识(Expected Consensus)，用来替代能源和计算资源严重浪费的工作量证明（Proof-of-Work）机制。

Power Fault Tolerance:影响力容错 :

这是filecoin协议里面对 PFT的解释，power概念就是矿工的影响力（influence），“Power”是filecoin系统的投票权力的大小度量，根据矿工贡献的Power来计算矿工的投票权有多大，根据信达雅的基本要求，所以称为“影响力容错”。

共识机制 :

- 选举秘密进行 （Secret）
- 选举是公平的 （Fair），基于一套规则，在规则的基础上概率起作用
- 最好没轮选举出一个领导人（Single Leader）
- 无法预测（Unpredictable）
- 十分容易验证 （Verifiable）
- 能够承受攻击（Anti-attack）
- 消耗资源不大（Efficient）

预期共识(Expected Consensus，EC)
预期共识实现了前面提到的几乎所有特性，就差一点。这一点就是不能实现单个领导人的选举，每一轮选举出来的领导人可能是多个，也可能没有.

Filecoin的共识机制吸收了共识机制发展中的各种成果，第一次实现了基于有价值的网络的共识算法。它包括：

- 基于存储的工作量证明（POW）共识
- 可扩展的拜占庭容错共识机制
- 权益证明（POS）共识机制

由于预期共识一轮选举可能产生多个领导人，这个问题怎么解决？很简单，都当领导，各自产生区块，而且每一个区块都有效。也就是说同一个高度就可能有多个区块。怎么处理？办法是，把这些区块再打包，称为一个tipset。因此，在Filecoin中，链并不能完全称为区块链，也应该是tipset链。一个tipset里包含一个或多个区块。也有的轮次中的选举没有领导人，怎么办呢？那就跳过，这个高度就是一个空块。这样一来，尽管不够均匀，但形成了链，而且是收敛的。




2. 挖矿密封数据的主要操作 </br>
	- P1 密封预交付阶段1 PoRep复制证明,此阶段受CPU限制,并且是单线程的,故需要强性能的CPU,SHA扩展的==AMD处理器==在很大程度上加快了此过程
	- P2 密封预交付阶段2 波塞冬(Poseidon)哈希算法执行Merkle树生成, 主要使用 GPU
	- C1 密封提交阶段1 执行生成证明所必需的准备工作的中间阶段 CPU运算
	- C2 该密封阶段涉及创建SNARK 将证明在广播之前进行压缩, GPU





### Fileoin的基础术语

- **Block和Epoch** </br>
	FileCoin 区块链中的 epoch 是离散为25秒的一个时期,每个 epoch 中,都会选择存储矿工的一个子集,这个子集会通过 Winning-of-Spacetime 来向 Filecoin 添加一个block区块.这个选择被称为选举,一个矿工当选的可能性大致与他们贡献的网络总存储容量占整个 Filecoin 网络的份额成正比.这些矿工提交的区块 block 一起构成了一个 tipset .
- **客户** </br>
	客户付费存储和检索数据.他们可以从可用的存储服务商中进行选择.如果他们想存储私有数据,则需要在将其提交给存储服务商之前对其进行加密.
- **存储矿工** </br>
	存储矿工存储客户的数据以获得奖励.他们决定愿意保留多少空间来存储.在客户和存储矿工达成协议后,矿工有义务继续提供其存储数据的证据.每个人都可以查看证据,并确保存储矿工可信.
- **检索矿工** </br>
	检索矿工根据他们的要求提供客户的数据.他们可以从客户或存储矿工那里获取数据.检索矿工和客户支付很少的费用来交换数据,数据被分成几部分,客户每片段支付很少费用.检索矿工也可以充当存储矿工.
- **片段** </br>
	片段是客户端存储在分散存储网络中的数据的一部分.例如,可以将数据(可能是一个目录)有意地分为许多部分,并且每个部分可以由一组不同的存储矿工存储.这主要取决于矿工采矿采用的sector大小,如32GB或64GB
- **扇区(Sector)** </br>
	扇区是存储矿工提供给网络的一些磁盘空间(可以认为是与特定存储提供者的磁盘空间的特定部分相关联的唯一ID).矿工将客户的物品存放在其所在的区域,并为其服务赚取代币.为了存储片段,存储矿工必须向网络保证其扇区可用.目前sector的大小有32GB和64GB两种.
- **订单和订单簿** </br>
	订单是请求或提供服务的意图声明.客户向市场提交标的订单以请求服务(分别是用于存储数据的存储市场和用于获取数据的检索市场),而矿工则接受订单以提供服务.订单簿是订单的集合. Filecoin 为存储市场和检索市场维护独立的订单簿.
- **承诺aka质押** </br>
	承诺是向网络提供存储(特别是扇区)的承诺.存储矿工必须向 Filecoin 区块链提交质押才能开始在存储市场中接受订单.质押包括质押扇区的规模和存储矿工存放的抵押币.
- **消减(Slash)** </br>
	当某个扇区出现故障的时候,Filecoin 网络会大幅减少本应该存储这个 sector 的存储矿工.并且会减去该矿工的总算力.
- **密封(Seal)** </br>
	密封是 Filecoin 协议的基本构建块之一.这是在一个扇区上执行的计算密集型过程,导致该扇区的唯一表示.这种新表示的性质是基本验证的复制的和验证的时空过程.
- **存储挖矿** </br>
	存储矿工的作用是代表 Filecoin 网络保存文件.存储矿工必须以加密方式证明他们兑现了存储这些文件的承诺–这是通过复制证明(PoRep)和时空证明(PoSt)机制实现的.将存储抵押到 Filecoin 网络本身需要 Filecoin .这些被用作担保,以确保存储矿工履行其合同义务.
- **储存资料** </br>
	在 Filecoin 网络中,数据存储在固定大小的扇区中.通常,存储矿工用代表客户存储的数据填充这些部门,客户通过交易在特定时间段内与存储矿工服务签约.但是,存储矿工并没有被迫进行交易.如果存储矿工没有找到任何有吸引力的交易建议,他们可以选择做出容量承诺,用任意数据填充部门.这使他们可以证明他们正在代表网络保留空间.如果需要,以后可以“升级”为充当容量承诺而创建的部门,以便为将来的交易提供合同存储空间.
- **非交互性零知识证明(zk-SNARK)** </br>
	验证者和证明者之间不需要进行交互,而仅仅只需要持有相对应随机数不同的hash值即可判定证明者的确证明了对应的事物.这里就需要证明者自证即为 WindowsPost
- **存储证明Proof-of-Storage** </br>

	许多区块链网络都以参与者为区块链提供某种价值这一观念为基础-这种贡献很难伪造,但如果确实做出了,则可以进行微不足道的验证.通常认为基于这种方法的区块链需要“ X证明”,其中X是有价值的贡献.Filecoin区块链重视存储容量的贡献；它以新颖的存储证明构造为基础,将其与其他区块链区分开来,而其他区块链在大多数情况下需要贡献计算能力.

	术语,存储证明是指Filecoin协议的设计元素,它使一个人可以保证(达到很高的容忍度)声称声称贡献了给定存储量的参与者确实履行了这一承诺.实际上,Filecoin的存储证明结构提供了更为强大的主张,使人们可以有效地验证参与者是否正在存储特定的数据,而无需一个人自己拥有文件的副本.

	注意 : 这里的“证明”是非正式的用法-通常,这些证明采取概率论证的形式,而不是具体的证明；也就是说,从技术上讲,可以说服其他参与者,一个人没有做出贡献,但是这种可能性微乎其微,几乎不可能
	
	PS : 存储证明是一个泛化的概念,挖矿软件的实际工作是下面的复制证明和时空证明.
- **复制证明Proof-of-Replication(PoRep)** </br>
	一旦该扇区已被填充,PoRep看到存储矿工密封 扇区-密封是计算密集的过程的结果在所述数据的唯一表示(原始表示随后可以通过重构开封).一旦数据被密封,存储矿工 : 生成证明；对证明运行SNARK进行压缩；最后,将压缩结果提交给区块链,作为存储承诺的证明.通过此过程为网络保留的存储称为抵押存储.
- **时空证明Proof-of-Spacetime(PoSt)** </br>
	PoRep完成后,存储矿工必须不断证明他们仍在存储他们承诺存储的数据.这是通过PoSt完成的,PoSt是向存储矿工发出加密挑战的过程,只有直接咨询密封部门才能正确回答.存储矿工必须在严格的时间限制内应对这一挑战；密封的计算难度确保了存储矿工必须保持对密封部门的随时访问和完整性.
- **窗口时空证明(WindowPost)** </br>
	WindowPoSt是一种机制,可用来审核存储矿工的承诺.它看到每个24小时周期分解为一系列窗口.相应地,每个存储矿工的保证扇区集都被划分为子集,每个窗口一个子集.在给定的窗口内,每个存储矿工必须为其各自子集中的每个扇区提交PoSt.这要求可以立即访问每个面临挑战的部门,并将导致将SNARK压缩的证据作为消息以块形式发布到区块链.这样,在每个24小时内至少对一次保证存储的每个sector进行一次审核,并保留一个永久,可验证的公共记录,以证明每个存储矿工的持续承诺.Filecoin网络期望存储文件的持续可用性.未按规定提交WindowPoSt的Sector将导致故障,存储矿工提供的Sector将被削减 -也就是说,他们的抵押品的一部分将被没收,他们的总算力将看到一个减少.在被认为完全放弃存储承诺之前,存储矿工将有有限的时间从故障中恢复.如果需要,存储矿工也将具有先提交有过错的能力,这将减少处罚,但仍必须在合理的时间内解决.
- **赢得时空证明(WinningPost)** </br>
	WinningPoSt是一种机制,通过这种机制可以奖励存储矿工的贡献.在Filecoin网络中,时间离散化为一系列时期-区块链的高度对应于经过的时期数.在每个时间点开始处,存储的矿工的少数当选到矿井新块(Filecoin利用 tipsets,其允许多个块而在相同的高度被开采).每个成功创建区块的当选矿工都将获得Filecoin,并有机会向其他节点收取费用以在区块中包含消息.存储矿工的当选概率与其存储能力相对应.在与基础WindowPoSt相似的过程中,存储矿工的任务是在epoch结束之前提交指定扇区的压缩存储证明.未能在必要的窗口中完成WinningPoSt的存储矿工将丧失开采区块的机会,但不会因未能这样做而受到处罚.
- **存储能力** </br>
	Filecoin存储矿工的能力与选择存储矿工开采区块的可能性相对应,与他们代表网络密封的存储量大致成比例.为了通过简单的容量承诺进一步激励“有用”数据的存储,存储矿工有额外的机会竞争经过验证的客户提供的特殊交易.此类客户在提供涉及存储有意义数据的交易意图方面获得了认证,并且存储矿工为这些交易赚取的权力将通过乘数得到增强.考虑到该乘数后,给定存储矿工拥有的总电量称为质量调整后的 电量.
- **存储市场** </br>
	客户向存储订单簿提交一个投标订单(使用PUT协议,在下一节中说明).客户必须存放订单中指定的费用并指定他们要存储的副本数量.客户可以提交多个订单,也可以在订单中指定复制因子.更高的冗余度(更高的复制因子)导致对存储故障的更高容错率(如下所述).

	==Manage.PledgeSector==
	存储矿工通过通过==Manage.PledgeSector==在区块链中通过质押交易存入抵押品来保证其对网络的存储.抵押品(Fil)在提供服务的时间内存放,如果矿工为其承诺存储的数据生成存储凭证,则将其退还.如果某些存储证明丢失,则会损失一定比例的抵押品.一旦质押交易出现在区块链中,矿工就可以在存储市场中提供其存储服务 : 他们设置价格并将要价单添加到市场的订单簿中.

	==Put.AddOrders==
	一旦质押交易出现在区块链中(在AllocTable中),矿工便可以在存储市场中提供其存储服务 : 他们设置价格并通过==Put.AddOrders==将要价订单添加到市场的订单簿中.

	==Put.MatchOrders==
	当找到匹配的要价和买价单时(通过==Put.MatchOrders==),客户将片段(数据)发送给矿工.

	==Put.ReceivePiece==
	当接收到片段,矿工运行==Put.ReceivePiece==.接收到数据后,矿工和客户都签署了交易订单并将其提交到区块链(在存储市场订单中)

	==Manage.AssignOrders==
	存储矿工的存储分为多个扇区,每个扇区包含分配给矿工的部分.网络通过分配表跟踪每个存储矿工的扇区.此时(签署交易订单时),网络会将数据分配给矿工,并在分配表中记录下来.

	==Manage.SealSector==
	当存储矿工扇区被填充时,该扇区被密封.密封是一种缓慢的顺序操作,它将扇区中的数据转换为副本,该副本是与存储矿工公钥关联的数据唯一物理副本.在复制证明期间,密封是必要的操作.

	==Manage.ProveSector==
	当为存储矿工分配数据时,他们必须反复生成复制证明以确保他们正在存储数据,证明会发布在区块链上,网络会对其进行验证.

	==Δfault==
	如果缺少任何证据或证据无效,则网络会通过存储矿工的抵押币对他们进行惩罚.
	如果大量证据缺失或无效(由系统参数Δfault定义),则网络会认为存储矿工有故障,将订单结算为失败,然后相同新订单重新引入市场.
	如果每个存储该矿工的都无法存储该片段,则该片段将丢失,并且客户将获得退款.
- **检索市场** </br>

	这是一个脱链交换,客户和检索矿工以对等方式彼此发现.一旦客户和矿工就价格达成协议,他们便开始使用小额付款逐笔交换数据和币.

	Get.AddOrders
	检索矿工通过在网络上散播他们的要价单 : 他们设置价格并将要价单添加到市场的订单簿中.

	Get.MatchOrders
	客户向投标市场订单簿提交投标订单.检索矿工检查其订单是否与客户的相应投标订单相匹配.

	Put.SendPiece
	订单匹配后,检索矿工将件发送给客户(矿工发送部分数据,客户发送小额付款).收到件后,矿工和客户都签署了交易订单并将其提交给区块链.
	
	
	
	
	
	
	
	
	
	
	
	
	
#### 推荐的学习路径文档列表

当然从头开始看是最完整的,不过我们可以分主次,有一些是越早了解完全越好的

1. FileCoin官方文档 [docs.Filecoin.io](https://docs.Filecoin.io/) ps官方的文档有可能一天都改动好多,看的时候多多刷新
2. [术语表](https://docs.Filecoin.io/reference/glossary)
3. FileCoin官方说明书 [spec.Filecoin.io](https://spec.Filecoin.io/)
4. Go-Filecoin的code review [github go-Filecoin code review](https://github.com/Filecoin-project/go-Filecoin/blob/master/CODEWALK.md)
5. 推荐的客户端工具Lotus [lotus.sh](https://lotu.sh/) , [lotus.github源码](https://github.com/Filecoin-project/lotus)
6. 关于Filecoin的存储证明教学 [proto_school](https://proto.school/tutorials) ,[proto school-verifying storage on Filecoin](https://proto.school/verifying-storage-on-Filecoin/)	